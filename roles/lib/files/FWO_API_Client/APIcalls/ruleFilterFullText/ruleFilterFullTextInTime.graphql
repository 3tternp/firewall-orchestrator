query ruleFilterFullTextInTime (
  $managementId: [Int!]
  $deviceId: [Int!]
  $ruleSrcName: [String!]
  $ruleSrcIp: [cidr!]
  $limit: Int
  $offset: Int
  $current: Boolean
  $reportTime: timestamp
) {
  management(
    where: { mgm_id: { _in: $managementId } }
    order_by: { mgm_name: asc }
  ) {
    mgm_id
    mgm_name
    devices(
      where: { dev_id: { _in: $deviceId } }
      order_by: { dev_name: asc }
    ) {
      dev_id
      dev_name
      rules_aggregate(
        limit: $limit
        offset: $offset
        where: {
          import_control: { stop_time: {_lte: $reportTime } }
          importControlByRuleLastSeen: { stop_time: {_gt: $reportTime } }
          active: { _eq: $current }
          rule_src: { _in: $ruleSrcName }
            rule_disabled: { _eq: false }
            rule_froms: { object: { obj_ip: { _in: $ruleSrcIp } } }          
        }
        order_by: { rule_num_numeric: asc }
      )  {
        aggregate {
          count
        }
      }
      rules(
        limit: $limit
        offset: $offset
        where: {
          import_control: { stop_time: {_lte: $reportTime } }
          importControlByRuleLastSeen: { stop_time: {_gt: $reportTime } }
          active: { _eq: $current }
          rule_src: { _in: $ruleSrcName }
            rule_disabled: { _eq: false }
            rule_froms: { object: { obj_ip: { _in: $ruleSrcIp } } }          
        }
        order_by: { rule_num_numeric: asc }
      ) {
        rule_uid
        rule_src
        lastSeenImport: importControlByRuleLastSeen {
          stop_time
          control_id
        }
        createImport: import_control {
          stop_time
          control_id
        }
      }
    }
  }
}