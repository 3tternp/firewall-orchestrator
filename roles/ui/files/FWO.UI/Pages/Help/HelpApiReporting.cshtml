@page "/help/API/reporting"
@model FWO.Ui.Pages.Help.MainModel
@{
    Layout = "HelpLayout";
}
@section sidebar{
    @{ 
        await Html.RenderPartialAsync("HelpAPISidebar.cshtml"); 
    }
}
@using FWO.Config.Api
@inject UserConfig userConfig

<div class="p-2">
    <h3>@userConfig.GetText("reporting")</h3>
    
    @userConfig.GetText("H6904")
    <br>

    <ol>
        <li>@userConfig.GetText("H6901")</li>
        <li>@userConfig.GetText("H6902")</li>
        Login
        <pre>
        curl --request POST \
            --url https://localhost:8888/api/AuthenticationToken/Get/ \
            --header 'content-type: application/json' \
            --data '{"Username": "reportingscheduler", "Password": "<pwd>"}'
        </pre>        
        Scheduling
        <pre>
curl --request POST \
            --insecure \
            --url https://localhost:9443/api/v1/graphql \
            --header 'content-type: application/json' \
            --header 'x-hasura-role: reporter-viewall' \
            --header 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1bmlxdWVfbmFtZSI6InJlcG9ydHNjaGVkdWxlciIsIngtaGFzdXJhLXVzZXItaWQiOiI0IiwieC1oYXN1cmEtdXVpZCI6InVpZD1yZXBvcnRzY2hlZHVsZXIsb3U9dGVuYW50MCxvdT1vcGVyYXRvcixvdT11c2VyLGRjPWZ3b3JjaCxkYz1pbnRlcm5hbCIsIngtaGFzdXJhLXRlbmFudC1pZCI6IjEiLCJ4LWhhc3VyYS12aXNpYmxlLW1hbmFnZW1lbnRzIjoieyAyLDEgfSIsIngtaGFzdXJhLXZpc2libGUtZGV2aWNlcyI6InsgMSwyIH0iLCJyb2xlIjoicmVwb3J0ZXItdmlld2FsbCIsIngtaGFzdXJhLWFsbG93ZWQtcm9sZXMiOlsicmVwb3J0ZXItdmlld2FsbCJdLCJ4LWhhc3VyYS1kZWZhdWx0LXJvbGUiOiJyZXBvcnRlci12aWV3YWxsIiwibmJmIjoxNjM3MTY4Mjk1LCJleHAiOjE2MzcxODI3NTUsImlhdCI6MTYzNzE2ODI5NSwiaXNzIjoiRldPIE1pZGRsZXdhcmUgTW9kdWxlIiwiYXVkIjoiRldPIn0.L9lsqiJFdJMSJlZliSPdw0W12flubvV99W2-xpmEXD5C5JLzxPIJEknAyIxCe0oqesm7_a56qO3uTNFPTbrCvuVApYLyR-Y4qN4BpGnIWy9L9PZyvtpogAhy8079sBrmOF8DmUYX8NwpqxgbW-9ilbO7OvktCwpIc-5XERF5BH5SGXbQkG6KToPAKVpG5a-XlUX9ppzf14gZyBRgfviiVX4HMlFmPe8dkDdLCJzb_t0xhso8Fat8xPHKw1U3h_x5L2us041olr5x-BOhoRLyO1NgQfonTQPrJLW7sU576e6I9lAbD9SiQgXebL3OAkrDIDHBL1kZvJSbd3UxAAabFA' \
            --data '
            {
            "variables": 
                {
                    "report_schedule_name": "test-report-api-20",
                    "report_schedule_owner_id": 4,
                    "report_schedule_template_id": 1,
                    "report_schedule_start_time": "2021-11-17 20:37",
                    "report_schedule_repeat": 1,
                    "report_schedule_every": 2,
                    "report_schedule_active": true,
                    "report_schedule_formats": {"data": {"report_schedule_format_name": "json"}}
                },
            "query": "mutation addReportSchedule($report_schedule_name: String!, $report_schedule_owner_id: Int!, $report_schedule_template_id: Int!, $report_schedule_start_time: timestamp!, $report_schedule_repeat: Int!, $report_schedule_every: Int!, $report_schedule_active: Boolean!, $report_schedule_formats: report_schedule_format_arr_rel_insert_input!) { insert_report_schedule(objects: {report_schedule_name: $report_schedule_name, report_schedule_owner: $report_schedule_owner_id, report_schedule_start_time: $report_schedule_start_time, report_schedule_repeat: $report_schedule_repeat, report_schedule_every: $report_schedule_every, report_template_id: $report_schedule_template_id, report_schedule_active: $report_schedule_active, report_schedule_formats: $report_schedule_formats}) { returning { report_schedule_id } } } "}'
        </pre>        
        <li>@userConfig.GetText("H6903")</li>
        <pre>
curl --request POST \
            --insecure \
            --url https://localhost:9443/api/v1/graphql \
            --header 'content-type: application/json' \
            --header 'x-hasura-role: reporter-viewall' \
            --header 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1bmlxdWVfbmFtZSI6InJlcG9ydHNjaGVkdWxlciIsIngtaGFzdXJhLXVzZXItaWQiOiI0IiwieC1oYXN1cmEtdXVpZCI6InVpZD1yZXBvcnRzY2hlZHVsZXIsb3U9dGVuYW50MCxvdT1vcGVyYXRvcixvdT11c2VyLGRjPWZ3b3JjaCxkYz1pbnRlcm5hbCIsIngtaGFzdXJhLXRlbmFudC1pZCI6IjEiLCJ4LWhhc3VyYS12aXNpYmxlLW1hbmFnZW1lbnRzIjoieyAyLDEgfSIsIngtaGFzdXJhLXZpc2libGUtZGV2aWNlcyI6InsgMSwyIH0iLCJyb2xlIjoicmVwb3J0ZXItdmlld2FsbCIsIngtaGFzdXJhLWFsbG93ZWQtcm9sZXMiOlsicmVwb3J0ZXItdmlld2FsbCJdLCJ4LWhhc3VyYS1kZWZhdWx0LXJvbGUiOiJyZXBvcnRlci12aWV3YWxsIiwibmJmIjoxNjM3MTY4Mjk1LCJleHAiOjE2MzcxODI3NTUsImlhdCI6MTYzNzE2ODI5NSwiaXNzIjoiRldPIE1pZGRsZXdhcmUgTW9kdWxlIiwiYXVkIjoiRldPIn0.L9lsqiJFdJMSJlZliSPdw0W12flubvV99W2-xpmEXD5C5JLzxPIJEknAyIxCe0oqesm7_a56qO3uTNFPTbrCvuVApYLyR-Y4qN4BpGnIWy9L9PZyvtpogAhy8079sBrmOF8DmUYX8NwpqxgbW-9ilbO7OvktCwpIc-5XERF5BH5SGXbQkG6KToPAKVpG5a-XlUX9ppzf14gZyBRgfviiVX4HMlFmPe8dkDdLCJzb_t0xhso8Fat8xPHKw1U3h_x5L2us041olr5x-BOhoRLyO1NgQfonTQPrJLW7sU576e6I9lAbD9SiQgXebL3OAkrDIDHBL1kZvJSbd3UxAAabFA' \
            --data '
            {
            "variables": 
                {
                    "reportName": "test-report12",
                    "startDate":"2021-11-17", 
                    "endDate":"2021-11-18"
                },
            "query": "{ query getReport($reportName: String!, $startDate: timestamp!, $endDate: timestamp!) { report(where: {report_name: {_eq: $reportName}, _and: [{report_end_time: {_gt: $startDate}}, {report_end_time: {_lt: $endDate}}]}) { report_json } } } "}'
        </pre>        
    </ol>
</div>
