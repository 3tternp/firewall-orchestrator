@using FWO.Ui.Data
@using FWO.ApiConfig

@inherits LayoutComponentBase
@layout MainLayout

@inject UserConfigCollection userConfig

<Sidebar PositionLeft="true" Collapsible="false" Resizeable="false" SidebarCssClass="navbar-dark bg-dark" InitialWidth="sidebarWidth" @bind-Width="sidebarWidth">
    <div class="m-2">
        <ul class="navbar-nav flex-column">
            <AuthorizeView Roles="admin">
                <Authorized>
                    @foreach (NavItem navItem in adminNavItems)
                    {
                        <li class="nav-item px-2">
                            <NavLink class="nav-link" href="@navItem.Link">
                                @navItem.Name() <span class="@navItem.Symbol"></span>
                            </NavLink>
                        </li>
                    }
                </Authorized>
            </AuthorizeView>
            <AuthorizeView Roles="admin, reporter, reporter-viewall, workflow-user, workflow-admin">
                <Authorized>
                    @foreach (NavItem navItem in userNavItems)
                    {
                        <li class="nav-item px-2">
                            <NavLink class="nav-link" href="@navItem.Link">
                                @navItem.Name() <span class="@navItem.Symbol"></span>
                            </NavLink>
                        </li>
                    }
                </Authorized>
            </AuthorizeView>
        </ul>
    </div>
</Sidebar>

    
<div style="margin-left: @($"{sidebarWidth + 20}px");">
    @Body
</div>

@code
{
    private int sidebarWidth = 200;

    private NavItem[] adminNavItems;
    private NavItem[] userNavItems;

    protected override void OnInitialized()
    {
        adminNavItems = new NavItem[]
        {
            new NavItem(() => "Managements", "settings/managements", "oi oi-inbox"),
            new NavItem(() => "Gateways", "settings/gateways", "oi oi-shield"),
            new NavItem(() => "Authorization", "settings/authorization", "oi oi-lock-locked"),
        };

        userNavItems = new NavItem[]
        {
            new NavItem(() => "Personal", "settings/personal", "oi oi-person")
        };

        userConfig.OnChange += Update;
    }

    private async void Update(object sender, EventArgs args) => await InvokeAsync(StateHasChanged);
}

