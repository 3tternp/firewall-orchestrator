---
- name: check if fortigate sample config exists
  stat:
    path: "{{ sample_config_user_home }}/sample-configs/fortinet_demo/fortigate.cfg"
  register: forti_sample_config

- name: copy sample configs
  copy:
    src: "sample-configs"
    dest: "{{ sample_config_user_home }}"
    owner: "{{ sample_config_user }}"
    group: "{{ fworch_group }}"
  when: not forti_sample_config.stat.exists
  become: yes

- name: include test data
  include_role:
    name: sample-data
  vars:
    sample_role_purpose: test
    sample_fortigate_name: fortigate_test
    sample_config_user: fworchtest
    sample_config_user_home: "/home/{{ sample_config_user }}"
    import_sample_server: localhost

- name: make sample import
  command: "./fworch-importer-single.pl mgm_id=1"
  args:
    chdir: "{{ fworch_home }}/importer"
  become_user: "{{ fworch_user }}"
  become: yes

- name: remove sample config dir
  file:
    path: "{{ sample_config_user_home }}/sample-configs"
    state: absent
  when: "without_sample_data|bool"
  become: yes
