# this playbook contains auth server tests

- set_fact:
  - test_user="fritz"
  - test_pwd="fritz1"

- name: auth test get jwt
  command: |
    curl --request GET --insecure 
    --url http://{{ auth_hostname }}:{{ auth_web_listener_port }}/jwt 
    --header 'content-type: application/json' 
    --data '{ { "Username", {{ Username }} }, { "Password", {{ Password }} } }'
  register: sample_jwt
  changed_when: false

- name: auth get jwt test output
  debug:
    msg: "ERROR unexpected jwt test result (not equal 'OK'): {{ sample_jwt.stdout }}"
  when: sample_jwt.stdout is not match('OK')
