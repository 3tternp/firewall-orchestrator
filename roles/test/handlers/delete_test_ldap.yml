---
- name: delete ldap test data
  include_role:
    name: sample-auth-data
  vars:
    sample_postfix: "{{ test_postfix }}"
    sample_role_purpose: delete
    ldif_changetype: delete
  when: "'middlewareserver' in group_names"


# - name: falls oben nicht geht, copy the ldif templates to system
#   template:
#     src: "{{ item }}"
#     dest: "{{ middleware_ldif_dir }}/{{ item | basename | regex_replace('\\.j2$', '') }}"
#     force: yes
#   with_fileglob:
#     - /roles/sample-auth-data/templates/tree_*.j2
#   become: yes

# - name: add tree
#   command: "ldapmodify -H {{ openldap_url }} -D {{ openldap_superuser_dn }} -w {{ ldap_manager_pwd }} -x -f {{ item }}"
#   with_fileglob:
#     - {{ middleware_ldif_dir }}/tree_*.ldif